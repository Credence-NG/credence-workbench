---
import { getFromCookies } from '../api/Auth';
import LayoutStacked from '../app/LayoutStacked.astro';
import { PlatformRoles } from '../common/enums';
import PlatformSetting from '../components/PlatformSetting';
import { apiRoutes } from '../config/apiRoutes';
import { envConfig } from '../config/envConfig';
import { pathRoutes } from '../config/pathRoutes';
import API from '../config/ssrApiConfig';
import { checkUserSession } from '../utils/check-session';

const authenticated = await checkUserSession(Astro.cookies);
const route: string = pathRoutes.auth.sinIn;
if (!authenticated) {
	return Astro.redirect(route);
}

const role = getFromCookies(Astro.cookies, 'role');
if (role !== PlatformRoles.platformAdmin) {
	return Astro.redirect(pathRoutes.users.dashboard);
}

const token = getFromCookies(Astro.cookies, 'session');
const fetchPlatformAddminSetting = await API({
	url: `${apiRoutes.users.platformSettings}`,
	token,
	method: 'GET',
});
---

<LayoutStacked showOptions={true}>
	<PlatformSetting data={fetchPlatformAddminSetting} client:visible />
</LayoutStacked>
