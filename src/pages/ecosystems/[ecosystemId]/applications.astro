---
import LayoutSidebar from '../../../app/LayoutSidebar.astro';
import ApplicationList from '../../../components/Ecosystem/ApplicationList';
import { checkUserSession } from '../../../utils/check-session';
import { canPerformAction } from '../../../utils/ecosystemPermissions';

const { ecosystemId } = Astro.params;
const response = await checkUserSession({cookies: Astro.cookies, currentPath: Astro.url.pathname});

if (!response.authorized) {
	return Astro.redirect(response.redirect);
}

// Only Platform Admins can review applications
const canReview = await canPerformAction('canReviewApplications');
if (!canReview) {
	return Astro.redirect(`/ecosystems/${ecosystemId}/dashboard?error=unauthorized`);
}

if (!ecosystemId) {
	return Astro.redirect('/ecosystems');
}
---

<LayoutSidebar notFoundPage={!response.permitted}>
	<ApplicationList client:visible ecosystemId={ecosystemId} />
</LayoutSidebar>
